<!DOCTYPE html>
<html lang="pt">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
Skeleton
  <link href="https://getbootstrap.com/docs/4.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" />
</head>

<style>
  .login-card {
    position: absolute;
    left: 0;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
  }
</style>

<body>
  <div class="row d-flex justify-content-left p-5">
    <h2>Cadastro</h2>
  </div>
  <div class="container">
    <div class="row d-flex justify-content-center login-card">
      <div class="col-sm-8 col-md-5 col-lg-4">
        <div class="card">
          <article class="card-body">
            <h4 class="card-title text-center mb-5 mt-4">Cadastrar</h4>
            <hr />
            <p class="text-success text-center">Informe seus dados</p>
            <form id="form-signup" method="put" action="/signup">
              <div class="form-group">
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text">
                      <i class="fa fa-user"></i>
                    </span>
                  </div>
                  <input name="name" class="form-control " minlength="4" placeholder="Nome" type="text" required />
                </div>
                <!-- input-group.// -->
              </div>
              <div class="form-group">
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text">
                      <i class="fa fa-envelope"></i>
                    </span>
                  </div>
                  <input name="login" class="form-control " minlength="10" placeholder="Email" type="email" required />
                </div>
                <!-- input-group.// -->
              </div>
              <!-- form-group// -->
              <div class="form-group">
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text">
                      <i class="fa fa-lock"></i>
                    </span>
                  </div>
                  <input name="password" class="form-control" minlength="8" placeholder="Senha" type="password"
                    required />
                </div>
                <!-- input-group.// -->
              </div>
              <!-- form-group// -->
              <div class="form-group">
                <button type="submit" class="btn btn-primary btn-block">
                  Cadastrar
                </button>
              </div>

            </form>
          </article>
        </div>
        <!-- card.// -->
      </div>
    </div>
  </div>
</body>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>


  $(document).ready(function () {

    $("#form-signup").on('submit', function (e) {
      e.preventDefault();

      var submit_button = $(e).find(':submit')

      $(submit_button).prop("disabled", true);

      var url_method = encodeURI($(this).attr("action"));
      var request_method = $(this).attr("method");
      var form_data = $(this).serialize();
      $.ajax({
        url: url_method,
        type: request_method,
        data: form_data
      }).done(function (response) {
        var { login, name } = response
        if (login && name) {
          let message = `Usuário <b>${name}</b> criado!`;
          Swal.fire({
            position: 'center',
            icon: 'success',
            title: 'Sucesso!',
            html: message,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Ir para página de acesso',
            showConfirmButton: true
          }).then((result) => {
            if (result.isConfirmed) {
              window.location.href = '/login'
            }
          })
        }

      }).fail(function (response) {
        var { responseJSON } = response
        console.log("fail", responseJSON);

        if (responseJSON) {
          let message = 'Tivemos um problema, tente novamente.';
          if (responseJSON.msg) message = responseJSON.msg
          Swal.fire({
            position: 'center',
            icon: 'warning',
            title: 'Ops!',
            text: message,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Ok',
            showConfirmButton: true
          })
        }

      })


      $(submit_button).prop("disabled", true);

    })

  });
</script>

</html>